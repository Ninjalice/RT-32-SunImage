<!DOCTYPE html>
<html>
<head>
    <title>RT-32 LNSP Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h2 {
            text-align: center;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .input-group {
            margin: 10px 0;
        }
        #dataContainer {
            border: 1px solid #ccc;
            padding: 10px;
            width: 80%;
            height: 400px;
            overflow-y: scroll;
            display: flex;
            flex-direction: column-reverse;
            margin: 20px 0;
        }
        button {
            margin: 5px;
        }
        #weatherData {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 80%;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io();

            socket.on('new_data', function(data) {
                const dataContainer = document.getElementById('dataContainer');
                const div = document.createElement('div');
                div.textContent = `Timestamp: ${data.timestamp}, Sensor Data: ${data.sensor_data}`;
                dataContainer.prepend(div);
            });

            document.getElementById('startButton').addEventListener('click', () => {
                const dateInput = document.getElementById('dateInput').value;
                const timeInput = document.getElementById('timeInput').value;
                fetch('/startReceiver', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ date: dateInput, time: timeInput })
                })
                .then(response => response.json())
                .then(data => alert(data.message));
            });

            document.getElementById('stopButton').addEventListener('click', () => {
                fetch('/stopReceiver', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => alert(data.message));
            });

            document.getElementById('getCurrentWeather').addEventListener('click', () => {
                fetch('/getCurrentWeather', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        const weatherData = document.getElementById('weatherData');
                        weatherData.innerHTML = `
                            <p>Temperature: ${data.temperature_2m || 'No data'}</p>
                            <p>Relative Humidity: ${data.relative_humidity_2m || 'No data'}</p>
                            <p>Precipitation: ${data.precipitation || 'No data'}</p>
                            <p>Rain: ${data.rain || 'No data'}</p>
                            <p>Showers: ${data.showers || 'No data'}</p>
                            <p>Snowfall: ${data.snowfall || 'No data'}</p>
                            <p>Cloud Cover: ${data.cloud_cover || 'No data'}</p>
                            <p>Surface Pressure: ${data.surface_pressure || 'No data'}</p>
                            <p>Wind Speed: ${data.wind_speed_10m || 'No data'}</p>
                            <p>Wind Direction: ${data.wind_direction_10m || 'No data'}</p>
                            <p>Wind Gusts: ${data.wind_gusts_10m || 'No data'}</p>
                        `;
                    });
            });

            document.getElementById('calculateAntennaPositions').addEventListener('click', () => {
                const dateInput = document.getElementById('dateInput').value;
                const timeInput = document.getElementById('timeInput').value;

                // Parse the date and time inputs
                const date = new Date(`${dateInput}T${timeInput}`);

                fetch('/calculate_antenna_positions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        year: date.getFullYear(),
                        month: date.getMonth() + 1, // Months are zero-based
                        day: date.getDate(),
                        hour: date.getHours(),
                        minute: date.getMinutes()
                    })
                })
                .then(response => response.json())
                .then(data => alert(data));
            });

         
        });
    </script>
</head>
<body>
    <h1>RT-32 LNSP Control</h1>
    <div class="container">
        <div class="input-group">
            <label for="dateInput">Date (YYYY-MM-DD):</label>
            <input type="date" id="dateInput">
        </div>
        <div class="input-group">
            <label for="timeInput">Time (HH:MM):</label>
            <input type="time" id="timeInput">
        </div>
        <button id="startButton">Start Receiver</button>
        <button id="stopButton">Stop Receiver</button>
        <button id="getCurrentWeather">Get Current Weather</button>
        <button id="calculateAntennaPositions">Calculate Antenna Positions</button>
        <button id="sendPTFtoACU">Send PTF to ACU</button>
    </div>
    <h2>Received Data</h2>
    <div id="weatherData">No data</div>
    <div id="dataContainer"></div>
    
</body>
</html>
